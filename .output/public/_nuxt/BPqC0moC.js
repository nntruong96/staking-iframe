var ae=Object.defineProperty;var se=(n,r,s)=>r in n?ae(n,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[r]=s;var F=(n,r,s)=>se(n,typeof r!="symbol"?r+"":r,s);import{r as y,F as ne,G as T,o as H,H as J,d as oe,i as V,v,x as w,y as l,E as i,z as h,I as b,D as re,J as D,K as le,L as W,M as O,C as A,A as M,N as ie,O as ce}from"./D_pZHRcs.js";import{Q as ue,a as de,b as me,c as pe,d as ge,e as ve,f as we,g as ye,G as he,h as fe}from"./zUkphfeI.js";import{B as Ee,g as $,N as z,a as be,b as R,t as C,c as De}from"./CBmwknQc.js";import"./BGnIl5FR.js";import"./DfOv1mK1.js";import"./DlfdNm-l.js";import{b as N}from"./CjfcT0Ha.js";class Ce extends Ee{constructor(s){super(s);F(this,"client");this.client=new ue(this.getGrpcWebImpl(s))}async getValidatorDistributionInfo({validator_address:s}){try{const e=de.create({validator_address:s});return await this.retry(()=>this.client.ValidatorDistributionInfo(e))}catch(e){throw e}}async getValidatorOutstandingRewards({validator_address:s}){try{const e=me.create({validator_address:s});return await this.retry(()=>this.client.ValidatorOutstandingRewards(e))}catch(e){throw e}}async getValidatorCommission({validator_address:s}){try{const e=pe.create({validator_address:s});return await this.retry(()=>this.client.ValidatorCommission(e))}catch(e){throw e}}async getValidatorSlashes({validator_address:s,starting_height:e,ending_height:o}){try{const m=ge.create({validator_address:s,starting_height:e,ending_height:o});return await this.retry(()=>this.client.ValidatorSlashes(m))}catch(m){throw m}}async getDelegationRewards({delegator_address:s,validator_address:e}){try{const o=ve.create({delegator_address:s,validator_address:e});return await this.retry(()=>this.client.DelegationRewards(o))}catch(o){throw o}}async getDelegationTotalRewards({delegator_address:s}){try{const e=we.create({delegator_address:s});return await this.retry(()=>this.client.DelegationTotalRewards(e))}catch(e){throw e}}async getDelegatorWithdrawAddress({delegator_address:s}){try{const e=ye.create({delegator_address:s});return await this.retry(()=>this.client.DelegatorWithdrawAddress(e))}catch(e){throw e}}}var f=(n=>(n.DELEGATE="DELEGATE",n.UNDELEGATE="UNDELEGATE",n.REDELEGATE="REDELEGATE",n.CLAIM_REWARDS="CLAIM_REWARDS",n))(f||{}),G=(n=>(n.DATE_CHANGE="data-change",n.CONNECT="connect-intent-solver",n.CONNECTED="connected-intent-solver",n.SUCCESS="success-intent-solver",n.ADDRESS_CHANGE="address-change",n))(G||{});const L=()=>{let n=$(z.Testnet);const r=new he(n.lcd,{transport:be()});return new fe(r)},Ae=async()=>{try{return await L().Validators({})}catch(n){console.log("Iframe",n)}return{validators:[]}},Re=async n=>{try{return await L().DelegatorUnbondingDelegations({delegator_addr:n})}catch(r){console.log("Iframe",r)}},ke=async(n,r)=>{var s;try{return{balance:((s=(await L().Delegation({delegator_addr:n,validator_addr:r.operator_address})).delegation_response)==null?void 0:s.balance)||{amount:"0",denom:"lux"}}}catch(e){console.log("Iframe",e)}return{balance:{amount:"0",denom:"lux"}}},Ie=async(n,r)=>{try{let s=$(z.Testnet);return await new Ce(s.lcd).getDelegationRewards({delegator_address:n,validator_address:r.operator_address})}catch(s){console.log("Iframe",s)}};function Ve(){const n=y(!1),r=y(""),s=ne({}),e=y({}),o=c=>{let p=c.data;switch(p.type){case"connected-intent-solver":r.value=p.address,n.value=!0;break;case"address-change":r.value=p.address;break}e.value[p.type]&&e.value[p.type].forEach(E=>E(p))},m=async()=>{const c=JSON.stringify({type:"connect-intent-solver",data:{}});window.parent.postMessage(c,document.referrer)};return T(()=>s,()=>{const c=JSON.stringify({type:"data-change",data:s});window.parent.postMessage(c,document.referrer)},{deep:!0}),H(()=>{window.addEventListener("message",o),m()}),J(()=>{window.removeEventListener("message",o)}),{connected:n,address:r,data:s,on:(c,p)=>{e.value[c]||(e.value[c]=[]),e.value[c].push(p)},off:(c,p)=>{e.value[c]&&(e.value[c]=e.value[c].filter(E=>E!==p))}}}const Ne=window.setInterval,Te={class:"w-full flex flex-col undelegate"},Ge={class:"grid grid-cols-1 sm:grid-cols-3 gap-2 text-sm"},Le={key:0,class:"col-span-1"},Se={key:1},_e=["onClick"],qe={class:"cell"},Ue={class:"cell"},xe={class:"cell"},Be={key:2,class:"w-full text-center mt-2 text-neutral-400"},Qe={class:"template mt-3"},Ze=oe({__name:"StakingIntentSolverIframe",props:{action:{}},setup(n){const r=n,s=y([]),e=y([]);y([]);const{address:o,data:m,on:k,off:S}=Ve(),c=y(!0),p=y(),E=y(""),K=V(()=>{let t=e.value.reduce((a,g)=>{var u;return a.plus(new R(((u=g.balance)==null?void 0:u.amount)||0))},new R(0));return C(t.toFixed(18))}),Z=V(()=>{let t=e.value.reduce((a,g)=>{var u;return a.plus(new R(((u=g.rewards)==null?void 0:u.amount)||0))},new R(0));return C(t.toFixed(18))}),_=async()=>{var u;if(!o.value)return;const{chainBankQueryClient:t}=De(),a=await t.getBalance(o.value,"lux"),g=N(((u=a.balance)==null?void 0:u.amount)||"0",18);E.value=C(g.toFixed(6))},j=async()=>{const t=await Ae();s.value=t.validators.map(a=>({title:a.description.moniker,value:a.description.moniker,operator_address:a.operator_address}))},X=async()=>{o.value&&await Re(o.value)},q=async()=>{s.value.forEach(async t=>{let a=await Ie(o.value,t);if(!a)return;a.rewards.forEach(u=>{const d=N(u.amount,36);u.amount=C(d.toFixed(18))});let g=e.value.find(u=>u.validator===t.title);g?g.rewards=a.rewards[0]:e.value.push({rewards:a.rewards[0],validator:t.title})})},Y=async()=>{if(!o.value)return c.value=!1;s.value.forEach(async t=>{let a=await ke(o.value,t),g=e.value.find(d=>d.validator===t.title);const u=N(a.balance.amount,18);a.balance.amount=C(u.toFixed(18)),g?g.balance=a.balance:e.value.push({balance:a.balance,validator:t.title}),c.value=!1})},P=t=>{m.validator_name=t.validator,m.amount=t.balance.amount},U=t=>{m.validator_name=t},I=()=>{Y(),q(),X(),_()};H(()=>{k(G.SUCCESS,I),j()}),J(()=>{S(G.SUCCESS,I),te()}),T([()=>o,()=>s],()=>{c.value=!0,I()},{deep:!0}),T(o,()=>{e.value=[],E.value="0",ee()});const ee=()=>{p.value&&clearInterval(p.value),p.value=Ne(()=>{q(),_()},5e3)},te=()=>{clearInterval(p.value)},x=V(()=>e.value.filter(t=>r.action===f.DELEGATE?!0:t.balance&&t.balance.amount>0));return(t,a)=>{const g=ce,u=ie;return v(),w("div",Te,[l("div",Ge,[t.action!==("EAction"in t?t.EAction:i(f)).REDELEGATE?(v(),w("div",Le,[a[2]||(a[2]=l("p",{class:"title"},"Your balances:",-1)),l("p",null,h(i(E)||0)+" lux",1)])):b("",!0),l("div",null,[a[3]||(a[3]=l("p",{class:"title"},"Total delegated:",-1)),l("p",null,h(i(K))+" lux",1)]),l("div",null,[a[4]||(a[4]=l("p",{class:"title"},"Claimable rewards:",-1)),l("p",null,h(i(Z))+" lux",1)])]),a[10]||(a[10]=l("p",{class:"title mb-4 mt-2"},"Your Validators",-1)),i(c)?(v(),re(g,{key:0,class:"!h-[60px]"})):(v(),w("table",Se,[a[5]||(a[5]=l("thead",null,[l("tr",{class:"text-left text-sm border-b border-blueGray-light-300"},[l("th",{class:"font-normal"},"Validator"),l("th",{class:"font-normal"},"Delegated Amount"),l("th",{class:"font-normal"},"Claimable Rewards")])],-1)),l("tbody",null,[(v(!0),w(D,null,le(i(x),d=>{var B,Q;return v(),w(D,{key:d.validator},[t.action===("EAction"in t?t.EAction:i(f)).DELEGATE||d.balance&&d.balance.amount>0?(v(),w("tr",{key:0,onClick:Fe=>P(d),class:"text-sm hover:bg-blueGray-light-300 cursor-pointer"},[l("td",qe,h(d.validator),1),l("td",Ue,h((B=d.balance)==null?void 0:B.amount)+" "+h(d.balance.denom),1),l("td",xe,h(((Q=d.rewards)==null?void 0:Q.amount)||0)+" "+h(d.balance.denom),1)],8,_e)):b("",!0)],64)}),128))])])),!i(x).length&&!i(c)?(v(),w("p",Be," No delegated validators ")):b("",!0),l("div",Qe,[t.action===("EAction"in t?t.EAction:i(f)).UNDELEGATE?(v(),w(D,{key:0},[a[6]||(a[6]=l("p",null,"Undelegate",-1)),W(l("input",{placeholder:"Amount","onUpdate:modelValue":a[0]||(a[0]=d=>i(m).amount=d),class:"template-input"},null,512),[[O,i(m).amount]]),a[7]||(a[7]=A(" lux from validator ")),M(u,{suggestions:i(s),value:i(m).validator_name,onChange:U,placeholder:"Validator Name",class:"container-class"},null,8,["suggestions","value"])],64)):b("",!0),t.action===("EAction"in t?t.EAction:i(f)).DELEGATE?(v(),w(D,{key:1},[a[8]||(a[8]=l("p",null,"Delegate",-1)),W(l("input",{placeholder:"Amount","onUpdate:modelValue":a[1]||(a[1]=d=>i(m).amount=d),class:"template-input"},null,512),[[O,i(m).amount]]),a[9]||(a[9]=A(" lux to validator ")),M(u,{suggestions:i(s),value:i(m).validator_name,onChange:U,placeholder:"Validator Name",class:"container-class"},null,8,["suggestions","value"])],64)):b("",!0),t.action===("EAction"in t?t.EAction:i(f)).CLAIM_REWARDS?(v(),w(D,{key:2},[A(" Claim all rewards from all validators ")],64)):b("",!0),t.action===("EAction"in t?t.EAction:i(f)).REDELEGATE?(v(),w(D,{key:3},[A(" Claim all rewards and delegate to same validators ")],64)):b("",!0)])])}}});export{f as E,Ze as _};
