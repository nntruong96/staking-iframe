var ne=Object.defineProperty;var se=(s,r,n)=>r in s?ne(s,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[r]=n;var W=(s,r,n)=>se(s,typeof r!="symbol"?r+"":r,n);import{r as f,F as oe,G,o as J,H as $,d as re,i as V,v,x as w,y as l,E as i,z as y,I as b,D as le,J as D,K as ie,L as O,M,C as R,A as H,N as ce,O as ue}from"./B2A4D-NE.js";import{Q as de,a as me,b as pe,c as ge,d as ve,e as we,f as fe,g as ye,G as he,h as Ee}from"./zUkphfeI.js";import{B as be,g as z,N as K,a as De,b as C,t as N,f as Ce,c as Ae}from"./D8IENT0a.js";import"./BBz8jAu-.js";import"./DnANGaAO.js";import"./C7PdnCVu.js";import{b as T}from"./Bf1jaTJu.js";class Re extends be{constructor(n){super(n);W(this,"client");this.client=new de(this.getGrpcWebImpl(n))}async getValidatorDistributionInfo({validator_address:n}){try{const t=me.create({validator_address:n});return await this.retry(()=>this.client.ValidatorDistributionInfo(t))}catch(t){throw t}}async getValidatorOutstandingRewards({validator_address:n}){try{const t=pe.create({validator_address:n});return await this.retry(()=>this.client.ValidatorOutstandingRewards(t))}catch(t){throw t}}async getValidatorCommission({validator_address:n}){try{const t=ge.create({validator_address:n});return await this.retry(()=>this.client.ValidatorCommission(t))}catch(t){throw t}}async getValidatorSlashes({validator_address:n,starting_height:t,ending_height:o}){try{const m=ve.create({validator_address:n,starting_height:t,ending_height:o});return await this.retry(()=>this.client.ValidatorSlashes(m))}catch(m){throw m}}async getDelegationRewards({delegator_address:n,validator_address:t}){try{const o=we.create({delegator_address:n,validator_address:t});return await this.retry(()=>this.client.DelegationRewards(o))}catch(o){throw o}}async getDelegationTotalRewards({delegator_address:n}){try{const t=fe.create({delegator_address:n});return await this.retry(()=>this.client.DelegationTotalRewards(t))}catch(t){throw t}}async getDelegatorWithdrawAddress({delegator_address:n}){try{const t=ye.create({delegator_address:n});return await this.retry(()=>this.client.DelegatorWithdrawAddress(t))}catch(t){throw t}}}var h=(s=>(s.DELEGATE="DELEGATE",s.UNDELEGATE="UNDELEGATE",s.REDELEGATE="REDELEGATE",s.CLAIM_REWARDS="CLAIM_REWARDS",s))(h||{}),L=(s=>(s.DATE_CHANGE="data-change",s.CONNECT="connect-intent-solver",s.CONNECTED="connected-intent-solver",s.SUCCESS="success-intent-solver",s.ADDRESS_CHANGE="address-change",s))(L||{});const _=()=>{let s=z(K.Testnet);const r=new he(s.lcd,{transport:De()});return new Ee(r)},ke=async()=>{try{return await _().Validators({})}catch(s){console.log("Iframe",s)}return{validators:[]}},Ie=async s=>{try{return await _().DelegatorUnbondingDelegations({delegator_addr:s})}catch(r){console.log("Iframe",r)}},Ve=async(s,r)=>{var n;try{return{balance:((n=(await _().Delegation({delegator_addr:s,validator_addr:r.operator_address})).delegation_response)==null?void 0:n.balance)||{amount:"0",denom:"lux"}}}catch(t){console.log("Iframe",t)}return{balance:{amount:"0",denom:"lux"}}},Ne=async(s,r)=>{try{let n=z(K.Testnet);return await new Re(n.lcd).getDelegationRewards({delegator_address:s,validator_address:r.operator_address})}catch(n){console.log("Iframe",n)}};function Te(){const s=f(!1),r=f(""),n=oe({}),t=f({}),o=c=>{let p=c.data;switch(p.type){case"connected-intent-solver":r.value=p.address,s.value=!0;break;case"address-change":r.value=p.address;break}t.value[p.type]&&t.value[p.type].forEach(E=>E(p))},m=async()=>{const c=JSON.stringify({type:"connect-intent-solver",data:{}});window.parent.postMessage(c,document.referrer)};return G(()=>n,()=>{const c=JSON.stringify({type:"data-change",data:n});window.parent.postMessage(c,document.referrer)},{deep:!0}),J(()=>{window.addEventListener("message",o),m()}),$(()=>{window.removeEventListener("message",o)}),{connected:s,address:r,data:n,on:(c,p)=>{t.value[c]||(t.value[c]=[]),t.value[c].push(p)},off:(c,p)=>{t.value[c]&&(t.value[c]=t.value[c].filter(E=>E!==p))}}}const Ge=window.setInterval,Le={class:"w-full flex flex-col undelegate"},_e={class:"grid grid-cols-1 sm:grid-cols-3 gap-2 text-sm"},Se={key:0,class:"col-span-1"},qe={key:1},xe=["onClick"],Ue={class:"cell"},Be={class:"cell"},Qe={class:"cell"},Fe={key:2,class:"w-full text-center mt-2 text-neutral-400"},We={class:"template mt-3"},Xe=re({__name:"StakingIntentSolverIframe",props:{action:{}},setup(s){const r=s,n=f([]),t=f([]);f([]);const{address:o,data:m,on:k,off:S}=Te(),c=f(!0),p=f(),E=f(""),Z=V(()=>{let a=t.value.reduce((e,g)=>{var u;return e.plus(new C(((u=g.balance)==null?void 0:u.amount)||0))},new C(0));return N(a.toFixed(2))}),A=a=>{const e=Ce(new C(a),.01);return typeof e=="string"?e:N(e.toFixed(2))},j=V(()=>{let a=t.value.reduce((e,g)=>{var u;return e.plus(new C(((u=g.rewards)==null?void 0:u.amount)||0))},new C(0));return A(a.toFixed(2))}),q=async()=>{var u;if(!o.value)return;const{chainBankQueryClient:a}=Ae(),e=await a.getBalance(o.value,"lux"),g=T(((u=e.balance)==null?void 0:u.amount)||"0",18);E.value=A(g.toFixed(2))},X=async()=>{const a=await ke();n.value=a.validators.map(e=>({title:e.description.moniker,value:e.description.moniker,operator_address:e.operator_address}))},Y=async()=>{o.value&&await Ie(o.value)},x=async()=>{n.value.forEach(async a=>{let e=await Ne(o.value,a);if(!e)return;e.rewards.forEach(u=>{const d=T(u.amount,36);u.amount=N(d.toFixed(18))});let g=t.value.find(u=>u.validator===a.title);g?g.rewards=e.rewards[0]:t.value.push({rewards:e.rewards[0],validator:a.title})})},P=async()=>{if(!o.value)return c.value=!1;n.value.forEach(async a=>{let e=await Ve(o.value,a),g=t.value.find(d=>d.validator===a.title);const u=T(e.balance.amount,18);e.balance.amount=u.toFixed(18),g?g.balance=e.balance:t.value.push({balance:e.balance,validator:a.title}),c.value=!1})},ee=a=>{m.validator_name=a.validator,m.amount=a.balance.amount},U=a=>{m.validator_name=a},I=()=>{P(),x(),Y(),q()};J(()=>{k(L.SUCCESS,I),X()}),$(()=>{S(L.SUCCESS,I),ae()}),G([()=>o,()=>n],()=>{c.value=!0,I()},{deep:!0}),G(o,()=>{t.value=[],E.value="0",te()});const te=()=>{p.value&&clearInterval(p.value),p.value=Ge(()=>{x(),q()},5e3)},ae=()=>{clearInterval(p.value)},B=V(()=>t.value.filter(a=>r.action===h.DELEGATE?!0:a.balance&&a.balance.amount>0));return(a,e)=>{const g=ue,u=ce;return v(),w("div",Le,[l("div",_e,[a.action!==("EAction"in a?a.EAction:i(h)).REDELEGATE?(v(),w("div",Se,[e[2]||(e[2]=l("p",{class:"title"},"Your balances:",-1)),l("p",null,y(i(E)||0)+" lux",1)])):b("",!0),l("div",null,[e[3]||(e[3]=l("p",{class:"title"},"Total delegated:",-1)),l("p",null,y(i(Z))+" lux",1)]),l("div",null,[e[4]||(e[4]=l("p",{class:"title"},"Claimable rewards:",-1)),l("p",null,y(i(j))+" lux",1)])]),e[10]||(e[10]=l("p",{class:"title mb-4 mt-2"},"Your Validators",-1)),i(c)?(v(),le(g,{key:0,class:"!h-[60px]"})):(v(),w("table",qe,[e[5]||(e[5]=l("thead",null,[l("tr",{class:"text-left text-sm border-b border-blueGray-light-300"},[l("th",{class:"font-normal"},"Validator"),l("th",{class:"font-normal"},"Delegated Amount"),l("th",{class:"font-normal"},"Claimable Rewards")])],-1)),l("tbody",null,[(v(!0),w(D,null,ie(i(B),d=>{var Q,F;return v(),w(D,{key:d.validator},[a.action===("EAction"in a?a.EAction:i(h)).DELEGATE||d.balance&&d.balance.amount>0?(v(),w("tr",{key:0,onClick:Oe=>ee(d),class:"text-sm hover:bg-blueGray-light-300 cursor-pointer"},[l("td",Ue,y(d.validator),1),l("td",Be,y(A((Q=d.balance)==null?void 0:Q.amount))+" "+y(d.balance.denom),1),l("td",Qe,y(A(((F=d.rewards)==null?void 0:F.amount)||0))+" "+y(d.balance.denom),1)],8,xe)):b("",!0)],64)}),128))])])),!i(B).length&&!i(c)?(v(),w("p",Fe," No delegated validators ")):b("",!0),l("div",We,[a.action===("EAction"in a?a.EAction:i(h)).UNDELEGATE?(v(),w(D,{key:0},[e[6]||(e[6]=l("p",null,"Undelegate",-1)),O(l("input",{placeholder:"Amount","onUpdate:modelValue":e[0]||(e[0]=d=>i(m).amount=d),class:"template-input"},null,512),[[M,i(m).amount]]),e[7]||(e[7]=R(" lux from validator ")),H(u,{suggestions:i(n),value:i(m).validator_name,onChange:U,placeholder:"Validator Name",class:"container-class"},null,8,["suggestions","value"])],64)):b("",!0),a.action===("EAction"in a?a.EAction:i(h)).DELEGATE?(v(),w(D,{key:1},[e[8]||(e[8]=l("p",null,"Delegate",-1)),O(l("input",{placeholder:"Amount","onUpdate:modelValue":e[1]||(e[1]=d=>i(m).amount=d),class:"template-input"},null,512),[[M,i(m).amount]]),e[9]||(e[9]=R(" lux to validator ")),H(u,{suggestions:i(n),value:i(m).validator_name,onChange:U,placeholder:"Validator Name",class:"container-class"},null,8,["suggestions","value"])],64)):b("",!0),a.action===("EAction"in a?a.EAction:i(h)).CLAIM_REWARDS?(v(),w(D,{key:2},[R(" Claim all rewards from all validators ")],64)):b("",!0),a.action===("EAction"in a?a.EAction:i(h)).REDELEGATE?(v(),w(D,{key:3},[R(" Claim all rewards and delegate to same validators ")],64)):b("",!0)])])}}});export{h as E,Xe as _};
